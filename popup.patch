diff --git a/src/popup.js b/src/popup.new.js
index ecbafd2..fba5bb1 100644
--- a/src/popup.js
+++ b/src/popup.new.js
@@ -1,59 +1,47 @@
-// popup.js — simplified UX
-// - Opens verification URL in a background tab (active: false) so current tab is unchanged.
-// - Shows device code in popup and a short instruction to go to the opened tab and paste the code.
-// - Hides detect/upload controls until the user is authenticated.
-// - Preserves "Remember me" behavior and defaults persistence.
+// popup.js — streamlined Device Flow UI logic
+// - Keeps sign-in instructions in the popup while opening the verification tab in the background.
+// - Hides detection/upload steps until the user is authenticated and shows a single "Remember me" option.
 
 const $ = id => document.getElementById(id);
-
 let lastProblemData = null;
+const workflowPanel = () => $('workflowPanel');
+const deviceInfoPanel = () => $('deviceInfo');
 
-function updateStatus(msg, isError = false) {
+function updateStatus(msg = '', isError = false) {
   const el = $('status');
   if (!el) return;
-  el.textContent = msg || '';
-  el.style.color = isError ? '#9b2c2c' : '#1a202c';
+  el.textContent = msg;
+  el.style.color = isError ? '#9b2c2c' : '#1f2937';
 }
 
-function updateAuthStatus(msg) {
+function updateAuthStatus(msg = '') {
   const el = $('authStatus');
   if (!el) return;
-  el.textContent = msg || '';
+  el.textContent = msg;
 }
 
-function showElement(id, show) {
-  const el = document.getElementById(id);
-  if (!el) return;
-  el.style.display = show ? '' : 'none';
+function setWorkflowVisibility(show) {
+  const panel = workflowPanel();
+  if (!panel) return;
+  panel.classList.toggle('hidden', !show);
 }
 
-// show or hide main interactive controls depending on auth state
-function setAuthenticatedUI(authenticated) {
-  // When not authenticated: show only sign-in controls and minimal status
-  showElement('signInBtn', !authenticated);
-  showElement('signOutBtn', authenticated);
-  showElement('rememberMe', true); // always show the checkbox
-  // Detection & upload controls
-  showElement('detectBtn', authenticated);
-  showElement('saveBtn', authenticated);
-  showElement('metaBox', authenticated);
-  showElement('owner', authenticated);
-  showElement('repo', authenticated);
-  showElement('branch', authenticated);
-  // deviceInfo should only show when a flow is active
-  // help link should always be available
+function setDeviceInfoVisibility(show) {
+  const panel = deviceInfoPanel();
+  if (!panel) return;
+  panel.classList.toggle('hidden', !show);
 }
 
-// Strip HTML safely for README (left for upload flow)
-function stripHtml(html) {
-  if (!html) return '';
-  try {
-    const d = document.createElement('div');
-    d.innerHTML = html;
-    return d.textContent || d.innerText || '';
-  } catch {
-    return html;
+function setAuthenticatedState(authenticated, maskedToken = '') {
+  const signInBtn = $('signInBtn');
+  const signOutBtn = $('signOutBtn');
+  if (signInBtn) signInBtn.style.display = authenticated ? 'none' : '';
+  if (signOutBtn) signOutBtn.style.display = authenticated ? '' : 'none';
+  setWorkflowVisibility(authenticated);
+  if (!authenticated) {
+    setDeviceInfoVisibility(false);
   }
+  updateAuthStatus(authenticated ? `Signed in • ${maskedToken}` : 'Not signed in');
 }
 
 function showMeta(data) {
@@ -82,7 +70,6 @@ function queryActiveTab() {
   });
 }
 
-// detect uses content script messaging (only available after auth UI visible)
 async function onDetect() {
   updateStatus('Detecting problem...');
   try {
@@ -95,7 +82,7 @@ async function onDetect() {
         chrome.scripting.executeScript({ target: { tabId }, files: ['src/content.js'] }, () => resolve());
       });
     } catch (e) {
-      // ignore injection errors; still try to message
+      console.warn('Injection attempt error', e);
     }
 
     await new Promise(r => setTimeout(r, 250));
@@ -110,16 +97,25 @@ async function onDetect() {
       updateStatus('Problem detected. Click Save to upload.');
     });
   } catch (err) {
-    updateStatus(err.message || 'Detect failed', true);
+    updateStatus(err.message || 'Detection failed', true);
   }
 }
 
-function buildReadme(problemData, notes) {
+function buildReadme(problemData) {
   const title = problemData.title || '';
   const url = problemData.url || '';
   const tags = (problemData.tags || []).join(', ');
   const difficulty = problemData.difficulty || '';
-  const description = stripHtml(problemData.contentHtml || '').trim();
+  const description = (function strip() {
+    if (!problemData.contentHtml) return '';
+    try {
+      const div = document.createElement('div');
+      div.innerHTML = problemData.contentHtml;
+      return div.textContent || div.innerText || '';
+    } catch {
+      return problemData.contentHtml;
+    }
+  })().trim();
 
   const lines = [];
   lines.push(`# ${title}`);
@@ -135,369 +131,226 @@ function buildReadme(problemData, notes) {
     lines.push('');
   }
   lines.push('---');
-  lines.push('_Generated by CodeBridge extension_');
+  lines.push('_Generated by LeetCode → GitHub Chrome extension_');
   return lines.join('\n');
 }
 
-// save defaults when user chooses "Remember me"
+function loadSavedDefaults() {
+  chrome.storage.local.get(['github_owner', 'github_repo', 'github_branch', 'remember_me'], (items) => {
+    if (!items) return;
+    if (items.github_owner) $('owner').value = items.github_owner;
+    if (items.github_repo) $('repo').value = items.github_repo;
+    if (items.github_branch) $('branch').value = items.github_branch;
+    $('rememberMe').checked = !!items.remember_me;
+  });
+}
+
 function saveDefaultsIfWanted() {
   const remember = !!$('rememberMe').checked;
   if (!remember) {
     chrome.storage.local.remove(['github_owner', 'github_repo', 'github_branch', 'remember_me']);
     return;
-  // popup.js — UI logic for streamlined Device Flow experience
-
-  const $ = id => document.getElementById(id);
-
-  let lastProblemData = null;
-
-  const workflowPanel = () => $('workflowPanel');
-  const deviceInfoPanel = () => $('deviceInfo');
-
-  function updateStatus(msg, isError = false) {
-    const el = $('status');
-    el.textContent = msg || '';
-    el.style.color = isError ? '#9b2c2c' : '#1f2937';
-  }
-
-  function updateAuthStatus(message) {
-    const el = $('authStatus');
-    el.textContent = message || '';
-  }
-
-  function setWorkflowVisibility(visible) {
-    workflowPanel().classList.toggle('hidden', !visible);
-  }
-
-  function setDeviceInfoVisibility(visible) {
-    deviceInfoPanel().classList.toggle('hidden', !visible);
-  }
-
-  function setAuthenticatedState(authenticated, maskedToken) {
-    $('signInBtn').style.display = authenticated ? 'none' : '';
-    $('signOutBtn').style.display = authenticated ? '' : 'none';
-    setWorkflowVisibility(authenticated);
-    if (!authenticated) {
-      setDeviceInfoVisibility(false);
-    }
-    const message = authenticated ? `Signed in • ${maskedToken || ''}` : 'Not signed in';
-    updateAuthStatus(message);
-  }
-
-  // Strip HTML safely for README
-  function stripHtml(html) {
-    if (!html) return '';
-    try {
-      const d = document.createElement('div');
-      d.innerHTML = html;
-      return d.textContent || d.innerText || '';
-    } catch {
-      return html;
-    }
-  }
-
-  function showMeta(data) {
-    if (!data) {
-      $('metaTitle').textContent = 'No problem detected';
-      $('metaIdUrl').textContent = '';
-      $('metaDifficulty').textContent = '';
-      $('metaTags').innerHTML = '';
-      $('metaLangExt').textContent = '';
-      $('detectedPath').textContent = '/0000-unknown/';
-      lastProblemData = null;
-      return;
-    }
-    lastProblemData = data;
-    $('metaTitle').textContent = `${data.id || '0000'} — ${data.title}`;
-    $('metaIdUrl').textContent = data.url || '';
-    $('metaDifficulty').textContent = data.difficulty ? `Difficulty: ${data.difficulty}` : '';
-    $('metaTags').innerHTML = (data.tags || []).map(t => `<span class="tag">${t}</span>`).join(' ');
-    $('metaLangExt').textContent = `Detected language: ${data.language || 'unknown'} — .${data.extension || 'txt'}`;
-    $('detectedPath').textContent = `/${data.folderName}/`;
-  }
-
-  function queryActiveTab() {
-    return new Promise((resolve) => {
-      chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => resolve(tabs));
-    });
   }
+  const owner = $('owner').value.trim();
+  const repo = $('repo').value.trim();
+  const branch = $('branch').value.trim() || 'main';
+  chrome.storage.local.set({
+    github_owner: owner,
+    github_repo: repo,
+    github_branch: branch,
+    remember_me: true
+  });
+}
 
-  async function onDetect() {
-    updateStatus('Detecting LeetCode problem...');
-    try {
-      const tabs = await queryActiveTab();
-      if (!tabs || tabs.length === 0) throw new Error('No active tab found');
-      const tabId = tabs[0].id;
-
-      try {
-        await new Promise((resolve) => {
-          chrome.scripting.executeScript(
-            { target: { tabId }, files: ['src/content.js'] },
-            () => resolve()
-          );
-        });
-      } catch (e) {
-        console.warn('Injection attempt error', e);
+async function checkAuthStatus() {
+  return new Promise((resolve) => {
+    chrome.runtime.sendMessage({ action: 'getAuthStatus' }, (resp) => {
+      if (chrome.runtime.lastError || !resp || !resp.success) {
+        setAuthenticatedState(false);
+        return resolve({ authenticated: false });
       }
-
-      await new Promise(r => setTimeout(r, 250));
-
-      chrome.tabs.sendMessage(tabId, { action: 'getProblemData' }, (response) => {
-        if (chrome.runtime.lastError) {
-          updateStatus('No response. Ensure you are on a leetcode.com problem page.', true);
-          showMeta(null);
-          return;
-        }
-        if (!response || !response.success) {
-          updateStatus('Failed to detect problem data.', true);
-          showMeta(null);
-          return;
-        }
-        showMeta(response.data);
-        updateStatus('Problem detected. Ready to upload.');
-      });
-    } catch (err) {
-      updateStatus(err.message || 'Detection failed', true);
-    }
-  }
-
-  function buildReadme(problemData) {
-    const title = problemData.title || '';
-    const url = problemData.url || '';
-    const tags = (problemData.tags || []).join(', ');
-    const difficulty = problemData.difficulty || '';
-    const description = stripHtml(problemData.contentHtml || '').trim();
-
-    const lines = [];
-    lines.push(`# ${title}`);
-    lines.push('');
-    if (difficulty) lines.push(`**Difficulty:** ${difficulty}`);
-    if (tags) lines.push(`**Tags:** ${tags}`);
-    if (url) lines.push(`**URL:** ${url}`);
-    lines.push('');
-    if (description) {
-      lines.push('## Problem');
-      lines.push('');
-      lines.push(description);
-      lines.push('');
-    }
-    lines.push('---');
-    lines.push('_Generated by LeetCode → GitHub Chrome extension_');
-    return lines.join('\n');
-  }
-
-  function loadSavedDefaults() {
-    chrome.storage.local.get(['github_owner', 'github_repo', 'github_branch', 'remember_me'], (items) => {
-      if (!items) return;
-      if (items.github_owner) $('owner').value = items.github_owner;
-      if (items.github_repo) $('repo').value = items.github_repo;
-      if (items.github_branch) $('branch').value = items.github_branch;
-      $('rememberMe').checked = !!items.remember_me;
+      setAuthenticatedState(resp.authenticated, resp.tokenMasked || '');
+      resolve(resp);
     });
-  }
-
-  function saveDefaultsIfWanted() {
-    const remember = !!$('rememberMe').checked;
-    if (!remember) {
-      chrome.storage.local.remove(['github_owner', 'github_repo', 'github_branch', 'remember_me']);
-      return;
-    }
-    const owner = $('owner').value.trim();
-    const repo = $('repo').value.trim();
-    const branch = $('branch').value.trim() || 'main';
-    chrome.storage.local.set({
-      github_owner: owner,
-      github_repo: repo,
-      github_branch: branch,
-      remember_me: true
-    });
-  }
+  });
+}
 
-  async function checkAuthStatus() {
-    return new Promise((resolve) => {
-      chrome.runtime.sendMessage({ action: 'getAuthStatus' }, (resp) => {
-        if (chrome.runtime.lastError) {
-          updateAuthStatus('Auth status unavailable');
-          setAuthenticatedState(false);
-          return resolve({ authenticated: false });
-        }
-        if (!resp || !resp.success) {
-          setAuthenticatedState(false);
-          return resolve({ authenticated: false });
-        }
-        setAuthenticatedState(resp.authenticated, resp.tokenMasked);
-        resolve(resp);
-      });
+function openAuthTab(url, { active = false } = {}) {
+  if (!url) return;
+  try {
+    chrome.tabs.create({ url, active }, () => {
+      updateStatus('GitHub tab opened. Paste the code there.');
     });
+  } catch (err) {
+    window.open(url, '_blank', 'noopener');
+    updateStatus('Unable to open GitHub tab automatically.', true);
   }
+}
 
-  function openAuthTab(url, opts = {}) {
-    if (!url) return;
-    const { active = false } = opts;
-    try {
-      chrome.tabs.create({ url, active }, () => {
-        updateStatus('GitHub tab opened. Paste the code there.');
-      });
-    } catch (err) {
-      window.open(url, '_blank', 'noopener');
-      updateStatus('Unable to open GitHub tab automatically.', true);
-    }
-  }
-
-  function bindEvents() {
-    $('detectBtn').addEventListener('click', onDetect);
-    $('saveBtn').addEventListener('click', onSave);
-
-    $('signInBtn').addEventListener('click', () => {
-      const remember = !!$('rememberMe').checked;
-      updateAuthStatus('Starting GitHub authorization...');
-      chrome.runtime.sendMessage({ action: 'startDeviceFlow', remember }, (resp) => {
-        if (chrome.runtime.lastError || !resp || !resp.success) {
-          updateAuthStatus('Failed to begin authorization.');
-          return;
-        }
-        const device = resp.device;
-        const url = device.verification_uri_complete || device.verification_uri;
-        $('deviceUrl').textContent = url || 'GitHub approval page';
-        $('deviceUrl').href = url || '#';
-        $('deviceCode').textContent = device.user_code || '—';
-        setDeviceInfoVisibility(true);
-        updateAuthStatus('Device Flow in progress. Complete the code in GitHub tab.');
-        openAuthTab(url);
-      });
-    });
-
-    $('signOutBtn').addEventListener('click', () => {
-      chrome.runtime.sendMessage({ action: 'signOut' }, (resp) => {
-        if (chrome.runtime.lastError) {
-          updateAuthStatus('Sign out failed');
-          return;
-        }
-        setAuthenticatedState(false);
-        updateStatus('Signed out.');
-      });
-    });
+function bindEvents() {
+  $('detectBtn').addEventListener('click', onDetect);
+  $('saveBtn').addEventListener('click', onSave);
 
-    $('copyCodeBtn').addEventListener('click', () => {
-      const code = $('deviceCode').textContent || '';
-      if (!code || code === '—') {
-        updateStatus('No code available', true);
+  $('signInBtn').addEventListener('click', () => {
+    const remember = !!$('rememberMe').checked;
+    updateAuthStatus('Starting GitHub authorization...');
+    chrome.runtime.sendMessage({ action: 'startDeviceFlow', remember }, (resp) => {
+      if (chrome.runtime.lastError || !resp || !resp.success) {
+        updateAuthStatus('Authorization failed to start.');
         return;
       }
-      navigator.clipboard.writeText(code).then(() => {
-        updateStatus('Code copied.');
-      }).catch(() => {
-        updateStatus('Cannot copy code', true);
-      });
+      const device = resp.device;
+      const url = device.verification_uri_complete || device.verification_uri;
+      $('deviceUrl').textContent = url || 'GitHub verification page';
+      $('deviceUrl').href = url || '#';
+      $('deviceCode').textContent = device.user_code || '—';
+      setDeviceInfoVisibility(true);
+      updateAuthStatus('Device Flow in progress. Complete the code in the opened tab.');
+      openAuthTab(url);
     });
+  });
 
-    $('openUrlBtn').addEventListener('click', () => {
-      const url = $('deviceUrl').href || '';
-      if (!url || url === '#') {
-        updateStatus('No GitHub URL', true);
+  $('signOutBtn').addEventListener('click', () => {
+    chrome.runtime.sendMessage({ action: 'signOut' }, (resp) => {
+      if (chrome.runtime.lastError) {
+        updateAuthStatus('Sign out failed.');
         return;
       }
-      openAuthTab(url, { active: true });
+      setAuthenticatedState(false);
+      updateStatus('Signed out.');
     });
+  });
 
-    $('helpLink').addEventListener('click', (event) => {
-      event.preventDefault();
-      if (chrome.runtime.openOptionsPage) {
-        chrome.runtime.openOptionsPage();
-      } else {
-        chrome.tabs.create({ url: chrome.runtime.getURL('src/options.html') });
-      }
+  $('copyCodeBtn').addEventListener('click', () => {
+    const code = $('deviceCode').textContent || '';
+    if (!code || code === '—') {
+      updateStatus('No code to copy.', true);
+      return;
+    }
+    navigator.clipboard.writeText(code).then(() => {
+      updateStatus('Code copied.');
+    }).catch(() => {
+      updateStatus('Unable to copy code.', true);
     });
+  });
 
-    chrome.runtime.onMessage.addListener((message) => {
-      if (!message || !message.action) return;
-      if (message.action === 'deviceFlowSuccess') {
+  $('openUrlBtn').addEventListener('click', () => {
+    const url = $('deviceUrl').href || '';
+    if (!url || url === '#') {
+      updateStatus('No GitHub URL available.', true);
+      return;
+    }
+    openAuthTab(url, { active: true });
+  });
+
+  $('helpLink').addEventListener('click', (event) => {
+    event.preventDefault();
+    if (chrome.runtime.openOptionsPage) {
+      chrome.runtime.openOptionsPage();
+    } else {
+      chrome.tabs.create({ url: chrome.runtime.getURL('src/options.html') });
+    }
+  });
+
+  chrome.runtime.onMessage.addListener((message) => {
+    if (!message || !message.action) return;
+    switch (message.action) {
+      case 'deviceFlowSuccess':
         setAuthenticatedState(true, message.tokenMasked || '');
         setDeviceInfoVisibility(false);
-        updateStatus('Signed in. You can now upload.');
-      } else if (message.action === 'deviceFlowError') {
+        updateStatus('Signed in. You can now upload your solution.');
+        break;
+      case 'deviceFlowError':
         setDeviceInfoVisibility(false);
         updateAuthStatus('Authorization error.');
-        updateStatus(message.message || 'Authorization failed', true);
-      } else if (message.action === 'deviceFlowExpired') {
+        updateStatus(message.message || 'Authorization failed.', true);
+        break;
+      case 'deviceFlowExpired':
         setDeviceInfoVisibility(false);
         setAuthenticatedState(false);
         updateStatus('Device flow expired. Retry sign in.', true);
-      } else if (message.action === 'deviceFlowDenied') {
+        break;
+      case 'deviceFlowDenied':
         setDeviceInfoVisibility(false);
-        updateAuthStatus('Authorization denied');
+        updateAuthStatus('Authorization denied.');
         updateStatus('Authorization denied by user.', true);
-      } else if (message.action === 'signedOut') {
+        break;
+      case 'signedOut':
         setAuthenticatedState(false);
         updateStatus('Signed out.');
-      }
-    });
+        break;
+      default:
+        break;
+    }
+  });
+}
+
+async function onSave() {
+  updateStatus('Preparing files...');
+  if (!lastProblemData) {
+    updateStatus('Detect a problem first.', true);
+    return;
   }
+  const owner = $('owner').value.trim();
+  const repo = $('repo').value.trim();
+  const branch = ($('branch').value || 'main').trim();
+  const allowUpdate = $('allowUpdate').checked;
 
-  async function onSave() {
-    updateStatus('Preparing files...');
-    if (!lastProblemData) {
-      updateStatus('Detect a problem first.', true);
-      return;
-    }
-    const owner = $('owner').value.trim();
-    const repo = $('repo').value.trim();
-    const branch = $('branch').value.trim() || 'main';
-    const allowUpdate = $('allowUpdate').checked;
+  if (!owner || !repo) {
+    updateStatus('Provide GitHub owner and repository.', true);
+    return;
+  }
+
+  const auth = await new Promise(resolve => chrome.runtime.sendMessage({ action: 'getAuthStatus' }, resolve));
+  if (!auth || !auth.success || !auth.authenticated) {
+    updateStatus('Not signed in. Please sign in with GitHub first.', true);
+    return;
+  }
 
-    if (!owner || !repo) {
-      updateStatus('Please provide GitHub owner and repository.', true);
+  saveDefaultsIfWanted();
+
+  const folder = lastProblemData.folderName;
+  const solutionName = `solution.${lastProblemData.extension || 'txt'}`;
+  const solutionContent = lastProblemData.code || '';
+  const readmeContent = buildReadme(lastProblemData);
+
+  updateStatus('Uploading to GitHub...');
+
+  const payload = {
+    action: 'uploadFiles',
+    owner,
+    repo,
+    branch,
+    folder,
+    files: [
+      { path: `${folder}/${solutionName}`, content: solutionContent, isBase64: false },
+      { path: `${folder}/README.md`, content: readmeContent, isBase64: false }
+    ],
+    allowUpdate
+  };
+
+  chrome.runtime.sendMessage(payload, (resp) => {
+    if (chrome.runtime.lastError) {
+      updateStatus(`Upload failed: ${chrome.runtime.lastError.message}`, true);
       return;
     }
-
-    const auth = await new Promise(resolve => chrome.runtime.sendMessage({ action: 'getAuthStatus' }, resolve));
-    if (!auth || !auth.success || !auth.authenticated) {
-      updateStatus('Not signed in. Please sign in first.', true);
+    if (!resp) {
+      updateStatus('No response from background.', true);
       return;
     }
-
-    saveDefaultsIfWanted();
-
-    const folder = lastProblemData.folderName;
-    const solutionName = `solution.${lastProblemData.extension || 'txt'}`;
-    const solutionContent = lastProblemData.code || '';
-    const readmeContent = buildReadme(lastProblemData);
-
-    updateStatus('Uploading to GitHub...');
-
-    const payload = {
-      action: 'uploadFiles',
-      owner,
-      repo,
-      branch,
-      folder,
-      files: [
-        { path: `${folder}/${solutionName}`, content: solutionContent, isBase64: false },
-        { path: `${folder}/README.md`, content: readmeContent, isBase64: false }
-      ],
-      allowUpdate
-    };
-
-    chrome.runtime.sendMessage(payload, (resp) => {
-      if (chrome.runtime.lastError) {
-        updateStatus(`Upload failed: ${chrome.runtime.lastError.message}`, true);
-        return;
-      }
-      if (!resp) {
-        updateStatus('No response from background.', true);
-        return;
-      }
-      if (resp.success) {
-        updateStatus(resp.message || 'Upload succeeded.');
-      } else {
-        updateStatus(resp.message || 'Upload failed.', true);
-      }
-    });
-  }
-
-  document.addEventListener('DOMContentLoaded', async () => {
-    bindEvents();
-    loadSavedDefaults();
-    await checkAuthStatus();
-    updateStatus('');
+    if (resp.success) {
+      updateStatus(resp.message || 'Upload succeeded.');
+    } else {
+      updateStatus(resp.message || 'Upload failed.', true);
+    }
   });
+}
+
+document.addEventListener('DOMContentLoaded', async () => {
+  bindEvents();
+  loadSavedDefaults();
+  setWorkflowVisibility(false);
+  setDeviceInfoVisibility(false);
+  await checkAuthStatus();
+  updateStatus('');
+});
