## How to Test the Codeforces Solution Fetching Fix

Now that the `handleFetchSubmissionCode` function has been refactored with more robust checks and detailed logging, please follow these steps to test the fix and gather diagnostic information:

1.  **Reload the Extension:**
    *   Open your browser's extension management page.
        *   For Chrome: Go to `chrome://extensions/`
        *   For Edge: Go to `edge://extensions/`
    *   Ensure "Developer mode" is enabled (usually a toggle in the top right).
    *   Find the "CodeBridge" extension.
    *   Click the "Reload" or "Refresh" button (a circular arrow icon) for the CodeBridge extension. This ensures the updated code is loaded.

2.  **Open Developer Tools for the Extension Background Page:**
    *   On the same extension management page, for the CodeBridge extension, click on the "background page" (or "service worker") link. This will open a new Developer Tools window dedicated to the extension's background script. Keep this window open.

3.  **Navigate to a Codeforces Problem Page:**
    *   In your regular browser window, go to a Codeforces problem page where you have an **"Accepted" solution** that you expect the extension to fetch. Make sure you are **logged in** to Codeforces.

4.  **Trigger the Solution Fetch:**
    *   Depending on how you normally use the extension:
        *   Click the CodeBridge extension icon in your browser toolbar.
        *   If auto-save is enabled, wait for it to trigger after a submission (though manually triggering via the popup is more reliable for immediate testing).

5.  **Observe the Background Page Console Output:**
    *   Switch back to the Developer Tools window for the background page.
    *   Go to the "Console" tab.
    *   **Look for the new log messages:**
        *   `[CodeBridge] Background fetching submission with credentials: [URL]`
        *   `[CodeBridge] Page fetched. Text length: [NUMBER]`
        *   `[CodeBridge] CSRF token found.` (or an error if not found)
        *   `[CodeBridge] Code block ID found.` (or an error if not found)
        *   `[CodeBridge] Code block extracted and decoded.`
        *   `[CodeBridge] Language detected: [LANGUAGE]`
        *   `[CodeBridge] Code extraction process completed successfully.`
    *   **Report the output:**
        *   **If it succeeds:** Please confirm that the solution is now correctly extracted and that you see all the success log messages.
        *   **If it fails:** Please copy and paste the *entire* error message you see, especially the ones starting with "Session Error" or "Structure Error". Also, report the last successful log message you saw before the error. This will tell us exactly where the new guards are failing.
